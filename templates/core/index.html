{% extends 'core/base.html' %}
{% load static %}
{% block page_title %}{{page_title}}{% endblock page_title %}
{% block custom_css %}
<style>
  /* Modern Dashboard Styles */
  .dashboard-container {
    padding: 20px;
    animation: fadeIn 0.5s ease-in;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  /* Modern Stat Cards */
  .stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    padding: 25px;
    color: white;
    margin-bottom: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    animation: slideUp 0.6s ease-out;
    animation-fill-mode: both;
  }
  
  .stat-card:nth-child(1) { animation-delay: 0.1s; }
  .stat-card:nth-child(2) { animation-delay: 0.2s; }
  .stat-card:nth-child(3) { animation-delay: 0.3s; }
  .stat-card:nth-child(4) { animation-delay: 0.4s; }
  
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .stat-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: rotate 20s linear infinite;
  }
  
  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  .stat-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
  }
  
  .stat-card.bg-info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
  
  .stat-card.bg-success {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  }
  
  .stat-card.bg-purple {
    background: linear-gradient(135deg, #8360c3 0%, #2ebf91 100%);
  }
  
  .stat-card.bg-danger {
    background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
  }
  
  .stat-card .inner {
    position: relative;
    z-index: 1;
  }
  
  .stat-card h3 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 10px;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }
  
  .stat-card p {
    font-size: 1rem;
    opacity: 0.95;
    margin-bottom: 15px;
    font-weight: 500;
  }
  
  .stat-card .icon {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 4rem;
    opacity: 0.3;
    transition: all 0.3s ease;
  }
  
  .stat-card:hover .icon {
    opacity: 0.5;
    transform: translateY(-50%) scale(1.1) rotate(5deg);
  }
  
  .stat-card .small-box-footer {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border-radius: 8px;
    padding: 10px 15px;
    display: inline-block;
    color: white;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.3);
  }
  
  .stat-card .small-box-footer:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateX(5px);
    color: white;
  }
  
  /* Quick Actions Section */
  .quick-actions-section {
    margin-top: 40px;
    margin-bottom: 30px;
  }
  
  .section-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 25px;
    position: relative;
    padding-bottom: 15px;
  }
  
  .section-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
  }
  
  .action-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
  }
  
  .action-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
    transition: left 0.5s ease;
  }
  
  .action-card:hover::before {
    left: 100%;
  }
  
  .action-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    border-color: #667eea;
  }
  
  .action-btn {
    width: 100%;
    padding: 15px 25px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    border: 2px solid #667eea;
    color: #667eea;
    background: white;
    position: relative;
    overflow: hidden;
  }
  
  .action-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: #667eea;
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
    z-index: 0;
  }
  
  .action-btn:hover::before {
    width: 300px;
    height: 300px;
  }
  
  .action-btn span {
    position: relative;
    z-index: 1;
  }
  
  .action-btn:hover {
    color: white;
    border-color: #667eea;
    transform: scale(1.05);
  }
  
  /* Analytics Section */
  .analytics-section {
    margin-top: 40px;
    background: white;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }
  
  .nav-tabs {
    border-bottom: 2px solid #e9ecef;
    margin-bottom: 30px;
  }
  
  .nav-tabs .nav-link {
    border: none;
    color: #6c757d;
    font-weight: 600;
    padding: 15px 25px;
    margin-right: 10px;
    border-radius: 10px 10px 0 0;
    transition: all 0.3s ease;
    position: relative;
  }
  
  .nav-tabs .nav-link::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 3px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: width 0.3s ease;
  }
  
  .nav-tabs .nav-link:hover {
    color: #667eea;
    background: rgba(102, 126, 234, 0.05);
  }
  
  .nav-tabs .nav-link.active {
    color: #667eea;
    background: rgba(102, 126, 234, 0.1);
  }
  
  .nav-tabs .nav-link.active::after {
    width: 100%;
  }
  
  .tab-content {
    animation: fadeIn 0.5s ease-in;
  }
  
  /* Notice Board */
  .notice-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
  }
  
  .notice-card:hover {
    transform: translateX(5px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
  }
  
  .notice-card .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
  }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .stat-card h3 {
      font-size: 2rem;
    }
    
    .stat-card .icon {
      font-size: 3rem;
    }
    
    .action-btn {
      padding: 12px 20px;
      font-size: 0.9rem;
    }
    
    .section-title {
      font-size: 1.5rem;
    }
  }
  
  /* Loading Animation */
  .loading-shimmer {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }
  
  @keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
  
  /* Chart Container */
  .chart-container {
    position: relative;
    height: 300px;
    margin-bottom: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
  }
</style>
{% endblock custom_css %}
{% block content %}
<section class="content dashboard-container">
    <div class="container-fluid">
        <!-- Modern Stat Cards -->
        <div class="row">
          {% if request.user.user_type == '1' %}
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="stat-card bg-info">
                    <div class="inner">
                        <h3>{{total_agents}}</h3>
                        <p><i class="fas fa-user-graduate mr-2"></i>My Agents</p>
                        <a href="#" class="small-box-footer">View Details <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-user-graduate"></i>
                    </div>
                </div>
            </div>
          {% endif %}
          {% if request.user.user_type == '1' or  request.user.user_type == '2' %}
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="stat-card bg-success">
                    <div class="inner">
                        <h3>{{total_tenants}}</h3>
                        <p><i class="fas fa-users mr-2"></i>My Tenants</p>
                        <a href="{% url 'tenant-list' %}" class="small-box-footer">View Details <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="stat-card bg-purple">
                    <div class="inner">
                        <h3>{{total_properties}}</h3>
                        <p><i class="fas fa-building mr-2"></i>Properties</p>
                        <a href="{% url 'property-list' %}" class="small-box-footer">View Details <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-building"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="stat-card bg-danger">
                    <div class="inner">
                        <h3>{{total_units}}</h3>
                        <p><i class="fas fa-home mr-2"></i>Property Units</p>
                        <a href="{% url 'property-list' %}" class="small-box-footer">View Details <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-home"></i>
                    </div>
                </div>
            </div>
            {% endif %}
            {% if request.user.user_type == '3' %}
            <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="stat-card bg-purple">
                    <div class="inner">
                        <h3>{{total_properties}}</h3>
                        <p><i class="fas fa-money-bill-wave mr-2"></i>Total Salary Paid</p>
                        <a href="{% url 'property-list' %}" class="small-box-footer">View Details <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-money-bill-wave"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="stat-card bg-danger">
                    <div class="inner">
                        <h3>{{total_units}}</h3>
                        <p><i class="fas fa-exclamation-circle mr-2"></i>Salary Owed</p>
                        <a href="{% url 'property-list' %}" class="small-box-footer">View Details <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-exclamation-circle"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="stat-card bg-info">
                    <div class="inner">
                        <h3>{{total_units}}</h3>
                        <p><i class="fas fa-file-invoice mr-2"></i>Payslips</p>
                        <a href="{% url 'property-list' %}" class="small-box-footer">View Details <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-file-invoice"></i>
                    </div>
                </div>
            </div>
            {% endif %}
            {% if request.user.user_type == '4' %}
            <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="stat-card bg-success">
                    <div class="inner">
                        <h3>KES {{actual_rent_paid|default:"0"}}</h3>
                        <p><i class="fas fa-check-circle mr-2"></i>Total Rent Paid</p>
                        <a href="{% url 'invoice-list' %}" class="small-box-footer">View History <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-check-circle"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="stat-card bg-danger">
                    <div class="inner">
                        <h3>KES {{actual_rent_owed|default:"0"}}</h3>
                        <p><i class="fas fa-exclamation-triangle mr-2"></i>Rent Owed</p>
                        <a href="{% url 'invoice-list' %}" class="small-box-footer">Pay Now <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="stat-card bg-info">
                    <div class="inner">
                        <h3>{{invoice_count|default:"0"}}</h3>
                        <p><i class="fas fa-file-invoice-dollar mr-2"></i>My Invoices</p>
                        <a href="{% url 'invoice-list' %}" class="small-box-footer">View All <i class="fas fa-arrow-right ml-2"></i></a>
                    </div>
                    <div class="icon">
                      <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Quick Actions Section -->
        <div class="quick-actions-section">
          {% if request.user.user_type == '1' or request.user.user_type == '2' %}
          <h2 class="section-title">Quick Actions for Owners &amp; Agents</h2>
          <div class="row">
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'property-create' %}" class="action-btn">
                  <span><i class="fas fa-plus-circle mr-2"></i>Add New Property</span>
                </a>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'lease-create' %}" class="action-btn">
                  <span><i class="fas fa-file-contract mr-2"></i>Create New Lease</span>
                </a>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'invoice-create' %}" class="action-btn">
                  <span><i class="fas fa-file-invoice mr-2"></i>Generate Invoice</span>
                </a>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'invoice-list' %}" class="action-btn">
                  <span><i class="fas fa-receipt mr-2"></i>View All Bills &amp; Payments</span>
                </a>
              </div>
            </div>
          </div>
          {% elif request.user.user_type == '3' %}
          {% if request.user.staff and request.user.staff.position %}
            {% with role=request.user.staff.position|lower %}
              {% if 'property manager' in role %}
              <h2 class="section-title">Quick Actions for Property Manager</h2>
              <div class="row">
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'invoice-create' %}" class="action-btn">
                      <span><i class="fas fa-file-invoice mr-2"></i>Generate Invoice</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'invoice-list' %}" class="action-btn">
                      <span><i class="fas fa-list mr-2"></i>View All Invoices</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'notice_add' %}" class="action-btn">
                      <span><i class="fas fa-bell mr-2"></i>View Notices &amp; Requests</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'profile' %}" class="action-btn">
                      <span><i class="fas fa-user-edit mr-2"></i>Update My Profile</span>
                    </a>
                  </div>
                </div>
              </div>
              {% elif 'facility manager' in role %}
              <h2 class="section-title">Quick Actions for Facility Manager</h2>
              <div class="row">
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'invoice-list' %}?maintenance=1" class="action-btn">
                      <span><i class="fas fa-tools mr-2"></i>View Maintenance Invoices</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'invoice-list' %}" class="action-btn">
                      <span><i class="fas fa-list mr-2"></i>View All Invoices</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'notice_add' %}" class="action-btn">
                      <span><i class="fas fa-wrench mr-2"></i>View Maintenance Requests</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'profile' %}" class="action-btn">
                      <span><i class="fas fa-user-edit mr-2"></i>Update My Profile</span>
                    </a>
                  </div>
                </div>
              </div>
              {% elif 'caretaker' in role or 'maintenance' in role %}
              <h2 class="section-title">Quick Actions for Maintenance Technician</h2>
              <div class="row">
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'notice_add' %}" class="action-btn">
                      <span><i class="fas fa-tools mr-2"></i>View Repair Requests</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'staff-salary-payment-list' %}" class="action-btn">
                      <span><i class="fas fa-money-check-alt mr-2"></i>View Salary Payments</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'profile' %}" class="action-btn">
                      <span><i class="fas fa-user-edit mr-2"></i>Update My Profile</span>
                    </a>
                  </div>
                </div>
              </div>
              {% elif 'security' in role or 'groundskeeping' in role %}
              <h2 class="section-title">Quick Actions for Security &amp; Groundskeeping</h2>
              <div class="row">
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'notice_add' %}" class="action-btn">
                      <span><i class="fas fa-bell mr-2"></i>View Notices</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'staff-salary-payment-list' %}" class="action-btn">
                      <span><i class="fas fa-money-check-alt mr-2"></i>View Salary Payments</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'profile' %}" class="action-btn">
                      <span><i class="fas fa-user-edit mr-2"></i>Update My Profile</span>
                    </a>
                  </div>
                </div>
              </div>
              {% else %}
              <h2 class="section-title">Quick Actions for Staff</h2>
              <div class="row">
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'staff-salary-payment-list' %}" class="action-btn">
                      <span><i class="fas fa-money-check-alt mr-2"></i>View Salary Payments</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'profile' %}" class="action-btn">
                      <span><i class="fas fa-user-edit mr-2"></i>Update My Profile</span>
                    </a>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-3">
                  <div class="action-card">
                    <a href="{% url 'notice_add' %}" class="action-btn">
                      <span><i class="fas fa-bell mr-2"></i>View Notices</span>
                    </a>
                  </div>
                </div>
              </div>
              {% endif %}
            {% endwith %}
          {% else %}
          <h2 class="section-title">Quick Actions for Staff</h2>
          <div class="row">
            <div class="col-lg-4 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'staff-salary-payment-list' %}" class="action-btn">
                  <span><i class="fas fa-money-check-alt mr-2"></i>View Salary Payments</span>
                </a>
              </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'profile' %}" class="action-btn">
                  <span><i class="fas fa-user-edit mr-2"></i>Update My Profile</span>
                </a>
              </div>
            </div>
            <div class="col-lg-4 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'notice_add' %}" class="action-btn">
                  <span><i class="fas fa-bell mr-2"></i>View Notices</span>
                </a>
              </div>
            </div>
          </div>
          {% endif %}
          {% elif request.user.user_type == '4' %}
          <h2 class="section-title">Quick Actions for Tenants</h2>
          <div class="row">
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'invoice-list' %}" class="action-btn">
                  <span><i class="fas fa-file-invoice-dollar mr-2"></i>View My Rent &amp; Utility Bills</span>
                </a>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'notice_add' %}" class="action-btn">
                  <span><i class="fas fa-tools mr-2"></i>Request Repairs / Maintenance</span>
                </a>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                {% if has_tenant_record %}
                <a href="{% url 'tenant-me' %}" class="action-btn">
                {% else %}
                <a href="#" class="action-btn" onclick="alert('Tenant profile not found. Please contact the administrator.'); return false;">
                {% endif %}
                  <span><i class="fas fa-user-circle mr-2"></i>My Tenant Profile</span>
                </a>
              </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
              <div class="action-card">
                <a href="{% url 'profile' %}" class="action-btn">
                  <span><i class="fas fa-cog mr-2"></i>Update My Account Details</span>
                </a>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
        <!-- Analytics Section -->
        {% if request.user.user_type == '1' or request.user.user_type == '2' %}
        <div class="analytics-section">
          <h2 class="section-title">{{site_title}} Analytics</h2>
          <ul class="nav nav-tabs" id="chartTabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link" id="property-tab" data-toggle="tab" href="#property" role="tab" aria-controls="property" aria-selected="false">Property Analysis</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="tenant-tab" data-toggle="tab" href="#tenant" role="tab" aria-controls="tenant" aria-selected="false">Tenant Analysis</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" id="lease-tab" data-toggle="tab" href="#lease" role="tab" aria-controls="lease" aria-selected="true">Lease Analysis</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="payment-tab" data-toggle="tab" href="#payment" role="tab" aria-controls="payment" aria-selected="false">Payment Analysis</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="deposit-tab" data-toggle="tab" href="#deposit" role="tab" aria-controls="deposit" aria-selected="false">Deposit Analysis</a>
            </li>
          </ul>
          <div class="tab-content" id="chartTabContent">
            <!-- Property Analysis Tab -->
            <div class="tab-pane fade" id="property" role="tabpanel" aria-labelledby="property-tab">
              <div class="row">
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="propertyDistributionChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="propertyCountChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="propertyOccupancyChart"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tenant Analysis Tab -->
            <div class="tab-pane fade" id="tenant" role="tabpanel" aria-labelledby="tenant-tab">
              <div class="row">
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="tenantCountChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="tenantGenderChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="tenantStatusChart"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Lease Analysis Tab -->
            <div class="tab-pane fade show active" id="lease" role="tabpanel" aria-labelledby="lease-tab">
              <div class="row">
                <div class="col-lg-6 col-md-12 mb-4">
                  <div class="chart-container">
                    <canvas id="leaseDurationChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-6 col-md-12 mb-4">
                  <div class="chart-container">
                    <canvas id="leaseStartDateChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-12 mb-4">
                  <div class="chart-container">
                    <canvas id="leaseExpirationChart"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Payment Analysis Tab -->
            <div class="tab-pane fade" id="payment" role="tabpanel" aria-labelledby="payment-tab">
              <div class="row">
                <div class="col-lg-6 col-md-12 mb-4">
                  <div class="chart-container">
                    <canvas id="PaymentTrendChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="paymentCollectionRateChart"></canvas>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4">
                  <div class="chart-container">
                    <canvas id="outstandingBalancesChart"></canvas>
                  </div>
                </div>
              </div>
            </div>

            <!-- Deposit Analysis Tab -->
            <div class="tab-pane fade" id="deposit" role="tabpanel" aria-labelledby="deposit-tab">
              <div class="row">
                <div class="col-lg-12 mb-4">
                  <div class="chart-container">
                    <canvas id="depositAmountChart"></canvas>
                  </div>
                </div>
              </div>

          </div>
        </div>
        {% endif %}
        {% if request.user.user_type == '4' or request.user.user_type == '3' %}
        <div class="quick-actions-section">
          <h2 class="section-title">Notice Board</h2>
          <div class="row">
            {% if welcome_note %}
            <div class="col-lg-6 col-md-12 mb-3">
              <div class="notice-card">
                <div class="card-header">
                  <h5 class="mb-0"><i class="fas fa-bullhorn mr-2"></i>{{welcome_note.notice_type|upper}}</h5>
                </div>
                <div class="mt-3">
                  <p>{{welcome_note.description|safe}}</p>
                </div>
                <form method="post" action="{% url 'hide_welcome' %}" class="mt-3">
                  {% csrf_token %}
                  <input type="hidden" name="pk" value="{{welcome_note.id}}" />
                  <button type="submit" class="btn btn-sm btn-warning">
                    <i class="fas fa-eye-slash mr-1"></i>Hide Notice
                  </button>
                </form>
              </div>
            </div>
            {% endif %}
            {% for notice in notices %}
            <div class="col-lg-6 col-md-12 mb-3">
              <div class="notice-card">
                <div class="card-header {% if notice.notice_type == 'mainatainance' %} bg-warning {% endif %}">
                  <h5 class="mb-0">
                    <i class="fas fa-{% if notice.notice_type == 'mainatainance' %}tools{% else %}info-circle{% endif %} mr-2"></i>
                    {{notice.notice_type|upper}}
                  </h5>
                </div>
                <div class="mt-3">
                  <p>{{notice.description|safe}}</p>
                </div>
                <form method="post" action="{% url 'hide_welcome' %}" class="mt-3">
                  {% csrf_token %}
                  <input type="hidden" name="pk" value="{{notice.id}}" />
                  <button type="submit" class="btn btn-sm btn-warning">
                    <i class="fas fa-check mr-1"></i>Mark as Read
                  </button>
                </form>
              </div>
            </div>
            {% empty %}
            <div class="col-12">
              <div class="notice-card text-center">
                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                <p class="text-muted">No unread notices at the moment!</p>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
    </div><!-- /.container-fluid -->
</section>
{% endblock content %}
{% block custom_js %}
<script>
 // chart-data.js
  // Property Distribution Chart
  const propertyDistributionData = {
    labels: {{property_types|safe}},
    datasets: [{
      label: 'Property Distribution',
      data:{{property_counts}},
      backgroundColor: ['#ff6384', '#36a2eb', '#ffcd56', '#fd6b19', '#4bc0c0']
    }]
  };

  new Chart(document.getElementById('propertyDistributionChart'), {
    type: 'pie',
    data: propertyDistributionData,
    options: {
    plugins: {
      chartjsPluginChartJs3d: {
        enabled: true,
        angle: 60,
        depth: 40,
      },
    },
  },
  });

  // Property Count Chart
  const propertyCountData = {
    labels: ['Total Properties'],
    datasets: [{
      data: [{{total_properties}}],
      backgroundColor: ['#4caf50']
    }]
  };

  new Chart(document.getElementById('propertyCountChart'), {
    type: 'doughnut',
    data: propertyCountData,
  });

  // Property Occupancy Chart
  const propertyOccupancyData = {
    labels: ['Rented Properties', 'Available Properties'],
    datasets: [{
      label:'Property Occupancy',
      data: [{{rented_properties|safe}}, {{available_properties|safe}}],
      backgroundColor: ['#ff6384', '#36a2eb']
    }]
  };

  new Chart(document.getElementById('propertyOccupancyChart'), {
    type: 'bar',
    data: propertyOccupancyData
  });

  // Tenant Count Chart
  const tenantCountData = {
    labels: ['Total Tenants'],
    datasets: [{
      data: [{{total_tenants|safe}}],
      backgroundColor: ['#9c27b0']
    }]
  };

  new Chart(document.getElementById('tenantCountChart'), {
    type: 'doughnut',
    data: tenantCountData
  });

  // Tenant Gender Chart
  const tenantGenderData = {
    labels: {{gender_count_labels|safe}},
    datasets: [{
      label: 'Tenant Gender',
      data: {{gender_count_data}},
      backgroundColor: ['#2196f3', '#f44336', '#ffc107']
    }]
  };

  new Chart(document.getElementById('tenantGenderChart'), {
    type: 'pie',
    data: tenantGenderData
  });

  // Tenant Status Chart
  const tenantStatusData = {
    labels: ['Active', 'Inactive'],
    datasets: [{
      label: 'Tenant Status',
      data: [{{active_counts}}, {{inactive_counts}}],
      backgroundColor: ['#4caf50', '#f44336']
    }]
  };

  new Chart(document.getElementById('tenantStatusChart'), {
    type: 'bar',
    data: tenantStatusData
  });

  // Lease Duration Chart
  const leaseDurationData = {
    labels: ['Average Duration', 'Median Duration'],
    datasets: [{
      label:'Lease Duration',
      data: [{{average_duration}}, {{median_duration}}],
      backgroundColor: ['#9c27b0', '#f44336']
    }]
  };

  new Chart(document.getElementById('leaseDurationChart'), {
    type: 'bar',
    data: leaseDurationData
  });

  // Lease Start Date Chart
  const leaseStartDateData = {
    labels: {{lease_start_dates_lables|safe}},
    datasets: [{
      label: 'Lease Start Dates',
      data: {{lease_start_dates_data|safe}},
      backgroundColor: '#2196f3'
    }]
  };

  new Chart(document.getElementById('leaseStartDateChart'), {
    type: 'line',
    data: leaseStartDateData
  });

  // Lease Expiration Chart
  const leaseExpirationData = {
    labels:[{% for expiration in upcoming_expirations %}'{{ expiration.property_unit }}',{% endfor %}],
    datasets: [{
      label:'Upcoming | Expired Lease Expirations',
      data:  [{% for expiration in upcoming_expirations %}new Date('{{ expiration.end_date }}'),{% endfor %}],
      backgroundColor: '#ff9800'
    }]
  };

  new Chart(document.getElementById('leaseExpirationChart'), {
    type: 'line',
    data: leaseExpirationData,
     options: {
                plugins: {
                    chart3d: {
                        enabled: true,
                        alpha: 45,
                        beta: 0
                    }
                }
            }
  });

  // Rent Payment Trend Chart
  const PaymentTrendData = {
    labels: {{months|safe}},
    datasets: [{
      label: "Monthly Rent Payments analytics for the year {% now 'Y' %}",
      data: {{month_totals|safe}},
      borderColor: '#4caf50',
      fill: false
    }]
  };

  new Chart(document.getElementById('PaymentTrendChart'), {
    type: 'line',
    data: PaymentTrendData
  });

  // Payment Collection Rate Chart
  const paymentCollectionRateData = {
    labels: ['On Time', 'Late'],
    datasets: [{
      data: [{{on_time_payments|safe}}, {{late_payments|safe}}],
      backgroundColor: ['#4caf50', '#f44336']
    }]
  };

  new Chart(document.getElementById('paymentCollectionRateChart'), {
    type: 'pie',
    data: paymentCollectionRateData,


  });

  // Outstanding Balances Chart
  const outstandingBalancesData = {
    labels: ['Total Outstanding'],
    datasets: [{
      data: [{{total_outstanding|safe}}],
      backgroundColor: ['#f44336']
    }]
  };

  new Chart(document.getElementById('outstandingBalancesChart'), {
    type: 'doughnut',
    data: outstandingBalancesData
  });

  // Deposit Amount Chart
  const depositAmountData = {
    labels: ['Min Deposit', 'Max Deposit', 'Avg Deposit', 'Total Deposit'],
    datasets: [{
      label:'Deposit Analytics',
      data: {{deposit_data|safe}},
      backgroundColor: ['#9c27b0', '#f44336', '#e14fb0', '#f40331']
    }]
  };

  new Chart(document.getElementById('depositAmountChart'), {
    type: 'bar',
    data: depositAmountData
  });


  </script>
{% endblock custom_js %}